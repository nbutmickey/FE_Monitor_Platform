<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>数据收集</title>
</head>

<body>
    test
</body>
<script type="text/javascript">
    (function () {
        var _app = _app || [];
        window._app = _app;
        //一个被检测应用对应一个AppID,AppID由服务端生成
        _app.push(['_appID', '85d4a553-ee8d-4136-80ab-2469adcae44d']);
        let xmlHttp;
        if (window.XMLHttpRequest) {
            xmlHttp = new XMLHttpRequest();
        } else {
            //IE6,IE5浏览器
            xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlHttp.withCredentials = true
        xmlHttp.open("GET", "http://192.168.31.88:3000/collect/clientID/?appID=85d4a553-ee8d-4136-80ab-2469adcae44d", true);
        xmlHttp.send();
        xmlHttp.onreadystatechange = function () {
            if (xmlHttp.readyState === 4) {
                if (xmlHttp.status >= 200 && xmlHttp.status < 300 || xmlHttp.status === 304) {
                    //写入cookie
                    let User_Cookie = JSON.parse(xmlHttp.responseText).cookie;
                    let exp = new Date();
                    exp.setTime(exp.getTime() + 365 * 24 * 60 * 60 * 1000);
                    document.cookie = "userID=" + User_Cookie + ";expires=" + exp.toGMTString();

                    let fp = document.createElement("script");
                    fp.type = "text/javascript";
                    fp.async = true;
                    fp.src = "http://192.168.31.88:3000/static/javascripts/collection.js";
                    let s = document.getElementsByTagName("script")[0];
                    s.parentNode.insertBefore(fp, s);
                }
            }
        }


    })()
</script>

</html>